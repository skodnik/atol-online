# Авторизация пользователя

Любой сеанс работы клиента начинается с прохождения процедуры авторизации, в ходе которой программный клиент от имени
пользователя получает авторизационный токен, однозначно идентифицирующий этого пользователя.

В результате аутентификации формируется специальный авторизационный токен, дающий право доступа к системе посредством
интеграционного API в течение 24 часов с момента его запроса. Полученный авторизационный токен в дальнейшем должен
передаваться в качестве параметра во все методы API, выполняющие какие–либо операции в контексте конкретного клиента.
Максимальная длина токена – 1000 символов.

Если в течение 24 часов с момента запроса токена повторно запросить токен, то вы получите новый токен и время его жизни
будет так же 24 часа, либо ранее полученный токен и время его жизни будет 24 часа от момента первого получения клиентом
этого токена. Количество одновременно действующих токенов, которые может получить клиент равно количеству реплик сервиса
АТОЛ Онлайн, работающих в текущий момент. Рекомендуется запрашивать новый токен только при получении от сервиса ошибки
об истечении времени жизни предыдущего токена (см. ошибку ExpiredToken в разделе 8.1 Ошибки сервиса).

Например, вы запросили повторно токен спустя 10 часов с момента первого запроса. Вы получите новый токен и он будет
действовать еще 24 часа, либо ранее выданный токен и он будет действовать 14 часов с момента этого запроса (24 часа с
момента его первой выдачи клиенту).

## Получение токена:

```php
try {
    $getTokenResponse = $atolApiClient->getToken();
} catch (\Vlsv\AtolOnline\Exception\ApiException $exception) {
    // Обработка исключения
}

if (!$getTokenResponse->getError()) {
    // По умолчанию, при вызове используется кеш если передан соответствующий объект кеша в конструктор,
    // это поведение можно переопределить передав false в ->getToken()
    $token = $getTokenResponse->getToken(); // С кешем
    $token = $getTokenResponse->getToken(false); // Без кеша
} else {
    // Обработка ошибки
}
```

При использовании кеша, срок хранения значение определяется настройками клиента, по умолчанию - 43200 секунд.
Префикс ключа кеша можно переопределить в конструкторе объекта `AtolApiClient`.

Когда токен окажется просроченным, автоматически будет выполнен запрос на получение нового.
